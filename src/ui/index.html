<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StackGazer</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîç</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript">
        // This script sets up default configuration for StackGazer.
        // Optional: Customize default settings for your deployment
        // You can override any of these settings based on your organization's needs
        window.stackGazerDefaults = {
            // Parsing options - customize for your codebase
            functionTrimPrefixes: 'github.com/cockroachdb/cockroach/pkg/',
            fileTrimPrefixes: 'bazel-out/k8-opt/bin/pkg/.*_go_proto_/,github.com/cockroachdb/cockroach/',

            // Category rules - customize stack categorization
            categorySkipRules: [
                // Skip basic Go utilities that launch goroutines.
                'sync.', 'internal/', 'golang.org/x/sync/errgroup',
                // Skip gRPC infra to find the server it is actually starting.
                'google.golang.org/grpc',
                // Skip general purpose CRDB helper utilities for launching goroutines.
                'util/stop', 'util/ctxgroup',    
                // Skip CRDB infrastructure that launches goroutines for other features to get to the feature instead.
                'jobs.', 'kv/kvclient/rangefeed.(*RangeFeed).run', 'kv/kvpb._', 
                // Skip CRDB base server layers to get to the actual server being booted.
                'rpc.NewServerEx',  'rpc.internalClientAdapter', 'rpc.makeInternalClientAdapter', 'rpc.serverStreamInterceptorsChain', 'rpc.kvAuth', // CRDB RPC utilities
                // Skip common dist helpers related to launching procs.
                'sql/flowinfra.(*FlowBase).StartInternal.func', 'sql/execinfra.(*ProcessorBaseNoHelper).Run', 'sql/execinfra.Run'
            ].join('\n'),
            
            categoryMatchRules: [
                's|^((([^\/.]*\\.[^\/]*)*\/)?[^\/.]+(\/[^\/.]+)?)|$1|'
            ].join('\n'),

            categoryIgnoredPrefixes: [
                'sync.', 'internal/', 'golang.org/x/sync/errgroup', // Stdlib libs that start goroutines.
                'util/stop', 'util/ctxgroup',                   // CRDB libs that start goroutines.
                'kv/kvclient/rangefeed.(*RangeFeed).run.func3', // invoker used to ensure stack is callers'.
            ].join('\n'),

            // Title manipulation rules - customize stack trace display
            nameSkipRules: [
                // Skip common low-level runtime frames.
                'sync.runtime_notifyListWait', 'sync.runtime_Semacquire', 
                'golang.org/x/sync/errgroup.(*Group).Wait',
                // Skip some common CRDB infra frames to get to the actual work.
                'rpc.NewContext.ClientInterceptor.func8',
                'kv/bulk.(*CPUPacer).Pace',
                'util/cidr.metricsConn.Read',
                'server.(*Node).batchInternal'
            ].join('\n'),
            
            nameTrimRules: [
                's|\\.func\\d+(\\.\\d+)?$||',
                'util/',
                's|^server.\\(\\*Node\\).Batch$|batch|'
            ].join('\n'),
            
            nameFoldRules: [
                's|sync.(*Cond).Wait,|condwait|',
                's|sync.(*WaitGroup).Wait,|waitgroup|',
                's|util/ctxgroup.Group.Wait,|waitgroup|',
                's|util/ctxgroup.GroupWorkers,|waitgroup|',
                's|util/ctxgroup.GoAndWait,|waitgroup|',
                's|net/http,stdlib|net/http|',
                's|syscall.Syscall,stdlib|syscall|',
                's|internal/poll.runtime_pollWait,stdlib|netpoll|',
                's|google.golang.org/grpc/internal/transport.(*Stream).waitOnHeader,google.golang.org/grpc|grpc|',
                's|util/admission.(*WorkQueue).Admit,^(util/admission|kv/kvserver/kvadmission)|AC|',
                's|google.golang.org/grpc/internal/transport.(*recvBufferReader).read,(google.golang.org/grpc.*|io.Read)|recv|',
            ].join('\n'),
            
            nameFindRules: [
                's|kv/kvclient/kvcoord.(*DistSender).Send,^(kv/kvclient/kvcoord|kv\\.)|DistSender|'
            ].join('\n'),

            // Zip file handling - customize for your file patterns
            zipFilePattern: '^(.*\/)?stacks\.txt$',

            // Name extraction patterns - customize for your application
            nameExtractionPatterns: [
                {
                    regex: 'pgwire\\.\\(\\*Server\\)\\.serveImpl.*?\\{0x1,\\s*0x2,\\s*\\{0x([0-9a-fA-F]+),',
                    replacement: 'hex:n$1',
                },
                {
                    regex: 'pgwire\\.\\(\\*Server\\)\\.serveImpl.*?\\{0x0,\\s*0x4,\\s*\\{0x([0-9a-fA-F]+),',
                    replacement: 'hex:n$1',
                },
                {
                    regex: '# labels:.*?"n":"([0-9]+)"',
                    replacement: 'n$1',
                },
            ]
        };
    </script>
    <!-- JSZip will be injected by vite plugin for lite builds -->
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <div class="filter-section file-section">
                <div class="files-header">
                    <div class="files-title">
                        <h3>Files <button class="add-file-btn" id="addFileBtn" title="Add more files">+</button></h3>
                    </div>
                    <button class="clear-all-btn" id="clearAllBtn" title="Clear all files">√ó</button>
                </div>
                <div class="file-list-container" id="fileListContainer">
                    <div class="file-list" id="fileList"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-header">
                    <h3>Filter</h3>
                    <button class="clear-all-btn" id="clearFilterBtn" title="Clear filter">√ó</button>
                </div>
                <input type="text" class="filter-input" id="filterInput" placeholder="e.g. flush">
            </div>

            <div class="filter-section">
                <h3>Statistics</h3>
                <div class="stats" id="stats">
                    <div class="stats-item">Stacks: <span id="stackCounts">0 / 0</span></div>
                    <div class="stats-item">Goroutines: <span id="goroutineCounts">0 / 0</span></div>
                    <div class="state-stats" id="stateStats"></div>
                </div>
            </div>

            <!-- Settings gear icon in bottom left -->
            <div class="settings-container">
                <a href="https://github.com/dt/stackgazer" target="_blank" class="github-btn" title="View on GitHub">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                    </svg>
                </a>
                <button class="theme-toggle-btn" id="themeToggleBtn" title="Toggle light/dark theme">üåô</button>
                <button class="settings-btn" id="settingsBtn" title="Advanced Settings">‚öôÔ∏è</button>
            </div>

        </div>

        <div class="main-content">
            <div class="view-controls-bar">
                <div class="left-controls">
                    <button id="backBtn" class="control-btn" disabled
                        title="Go back to previous goroutine (Alt+‚Üê or Backspace)">‚Üê Back</button>
                </div>
                <div class="right-controls">
                    <select id="stackDisplayModeSelect" title="Choose how to display stack traces">
                        <option value="combined">Combined View</option>
                        <option value="side-by-side">Side by Side</option>
                        <option value="functions">Functions Only</option>
                        <option value="locations">Locations Only</option>
                    </select>
                    <button id="unpinAllBtn" class="control-btn">Unpin All</button>
                    <button id="expandAllBtn" class="control-btn">Expand All</button>
                    <button id="collapseAllBtn" class="control-btn">Collapse All</button>
                </div>
            </div>
            <div class="drop-zone" id="dropZone">
                <!-- Initial content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Advanced Settings</h3>
                <button class="modal-close" id="settingsModalCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Categorization + Naming</h4>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Category Rules</span>
                        <button class="setting-help-icon"
                            data-tooltip="Rules to control how stacks are categorized:&#10;&#10;‚Ä¢ skip: Skip functions matching this pattern when determining category&#10;‚Ä¢ match: match and capture a subset of the frame (supports #N for capture groups and -- comments)&#10;&#10;The first non-skipped frame determines the category. If a match rule matches the category frame: its first capture group (or the capture chosen by optional `#N` suffix) is used. If no match matches the whole frame is the category.">?</button>
                    </div>
                    <div class="setting-description-prose">
                        <p><strong>Categorization</strong> is used to group stacks based on where they originated. Categories help organize related stacks together for easier analysis.</p>
                    </div>
                    
                    <div class="setting-title">
                        <span>Skip Rules</span>
                        <button class="setting-help-icon"
                            data-tooltip="One pattern per line. Frames matching these patterns will be ignored when determining category.">?</button>
                    </div>
                    
                    <div class="setting-description">Skip these patterns when categorizing stacks.</div>
                    
                    <!-- Default Rules Section -->
                    <div class="default-rules-section collapsed">
                        <div class="default-rules-header">
                            <div class="default-rules-title">
                                <div class="default-rules-title">
                                <span class="expand-icon">‚ñº</span>
                                <h5>Default Rules</h5>
                            </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="useDefaultCategorySkipRules" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="default-rules-content collapsed">
                            <textarea id="defaultCategorySkipRules" class="setting-textarea default-rules-textarea" rows="4" 
                                readonly placeholder="Default rules will appear here..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Custom Rules Section -->
                    <div class="custom-rules-section collapsed">
                        <div class="custom-rules-header">
                            <div class="custom-rules-title">
                                <h5>Custom Rules (0)</h5>
                            </div>
                        </div>
                        <div class="custom-rules-content collapsed">
                            <textarea id="customCategorySkipRules" class="setting-textarea" rows="2" 
                                placeholder="Add your own skip rules here..."></textarea>
                        </div>
                    </div>
                    
                    <div class="setting-title">
                        <span>Match Rules</span>
                        <button class="setting-help-icon"
                            data-tooltip="One pattern per line. Format: s|pattern|replacement| where replacement can use $1, $2, etc. for capture groups.">?</button>
                    </div>
                    
                    <div class="setting-description">Extract category names using these patterns.</div>
                    
                    <!-- Default Rules Section -->
                    <div class="default-rules-section collapsed">
                        <div class="default-rules-header">
                            <div class="default-rules-title">
                                <div class="default-rules-title">
                                <span class="expand-icon">‚ñº</span>
                                <h5>Default Rules</h5>
                            </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="useDefaultCategoryMatchRules" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="default-rules-content collapsed">
                            <textarea id="defaultCategoryMatchRules" class="setting-textarea default-rules-textarea" rows="2" 
                                readonly placeholder="Default rules will appear here..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Custom Rules Section -->
                    <div class="custom-rules-section collapsed">
                        <div class="custom-rules-header">
                            <div class="custom-rules-title">
                                <h5>Custom Rules (0)</h5>
                            </div>
                        </div>
                        <div class="custom-rules-content collapsed">
                            <textarea id="customCategoryMatchRules" class="setting-textarea" rows="2" 
                                placeholder="Add your own match rules here..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Stack Name Rules</span>
                        <button class="setting-help-icon"
                            data-tooltip="Stack names describe a stack by where it was at the time of profiling, i.e what it was doing or where it was waiting. These rules can help choose names more meaningful or useful at a glance than just e.g. 'semacquire' by skipping common low-level frames or combining frames into a concise description.&#10;&#10;‚Ä¢ skip: Skip matching functions&#10;‚Ä¢ trim: Remove prefix from function names&#10;‚Ä¢ fold: Replace pattern with specified text prepended to name derived from following frame&#10;  ‚Üí Can specify replacement text&#10;  ‚Üí Can specify 'while:' condition for continued folding">?</button>
                    </div>
                    <div class="setting-description-prose">
                        <p><strong>Naming</strong> determines the name given to each stack within a category. A name describes what a stack was doing, or where it was blocked, at time of profiling. Multiple, distinct stacks can have the same name if they were in the same place as of profiling.</p>
                    </div>
                    
                    <div class="setting-title">
                        <span>Skip Rules</span>
                        <button class="setting-help-icon"
                            data-tooltip="One pattern per line. Frames matching these patterns will be ignored when building stack names.">?</button>
                    </div>
                    
                    <div class="setting-description">Skip these patterns when naming stacks.</div>
                    
                    <!-- Default Rules Section -->
                    <div class="default-rules-section collapsed">
                        <div class="default-rules-header">
                            <div class="default-rules-title">
                                <span class="expand-icon">‚ñº</span>
                                <h5>Default Rules</h5>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="useDefaultNameSkipRules" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="default-rules-content collapsed">
                            <textarea id="defaultNameSkipRules" class="setting-textarea default-rules-textarea" rows="3" 
                                readonly placeholder="Default rules will appear here..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Custom Rules Section -->
                    <div class="custom-rules-section collapsed">
                        <div class="custom-rules-header">
                            <div class="custom-rules-title">
                                <h5>Custom Rules (0)</h5>
                            </div>
                        </div>
                        <div class="custom-rules-content collapsed">
                            <textarea id="customNameSkipRules" class="setting-textarea" rows="2" 
                                placeholder="Add your own skip rules here..."></textarea>
                        </div>
                    </div>
                    
                    <div class="setting-title">
                        <span>Trim Rules</span>
                        <button class="setting-help-icon"
                            data-tooltip="One pattern per line. Format: 'prefix' to remove prefix, or 's|pattern|replacement|' for regex replacement.">?</button>
                    </div>
                    
                    <div class="setting-description">Trim prefixes or apply regex replacements.</div>
                    
                    <!-- Default Rules Section -->
                    <div class="default-rules-section collapsed">
                        <div class="default-rules-header">
                            <div class="default-rules-title">
                                <span class="expand-icon">‚ñº</span>
                                <h5>Default Rules</h5>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="useDefaultNameTrimRules" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="default-rules-content collapsed">
                            <textarea id="defaultNameTrimRules" class="setting-textarea default-rules-textarea" rows="3" 
                                readonly placeholder="Default rules will appear here..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Custom Rules Section -->
                    <div class="custom-rules-section collapsed">
                        <div class="custom-rules-header">
                            <div class="custom-rules-title">
                                <h5>Custom Rules (0)</h5>
                            </div>
                        </div>
                        <div class="custom-rules-content collapsed">
                            <textarea id="customNameTrimRules" class="setting-textarea" rows="2" 
                                placeholder="Add your own trim rules here..."></textarea>
                        </div>
                    </div>
                    
                    <div class="setting-title">
                        <span>Fold Rules</span>
                        <button class="setting-help-icon"
                            data-tooltip="One rule per line. Format: s|pattern,while-pattern|replacement| where 'while-pattern' specifies what frames to consume after the match.">?</button>
                    </div>
                    
                    <div class="setting-description">Fold frame sequences into concise names.</div>
                    
                    <!-- Default Rules Section -->
                    <div class="default-rules-section collapsed">
                        <div class="default-rules-header">
                            <div class="default-rules-title">
                                <span class="expand-icon">‚ñº</span>
                                <h5>Default Rules</h5>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="useDefaultNameFoldRules" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="default-rules-content collapsed">
                            <textarea id="defaultNameFoldRules" class="setting-textarea default-rules-textarea" rows="4" 
                                readonly placeholder="Default rules will appear here..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Custom Rules Section -->
                    <div class="custom-rules-section collapsed">
                        <div class="custom-rules-header">
                            <div class="custom-rules-title">
                                <h5>Custom Rules (0)</h5>
                            </div>
                        </div>
                        <div class="custom-rules-content collapsed">
                            <textarea id="customNameFoldRules" class="setting-textarea" rows="2" 
                                placeholder="Add your own fold rules here..."></textarea>
                        </div>
                    </div>
                    
                    <div class="setting-title">
                        <span>Find Rules</span>
                        <button class="setting-help-icon"
                            data-tooltip="One rule per line. Format: s|pattern,while-pattern|replacement| to scan remaining frames and pull up matching information.">?</button>
                    </div>
                    
                    <div class="setting-description">Find patterns in remaining frames and prepend to stack name.</div>
                    
                    <!-- Default Rules Section -->
                    <div class="default-rules-section collapsed">
                        <div class="default-rules-header">
                            <div class="default-rules-title">
                                <span class="expand-icon">‚ñº</span>
                                <h5>Default Rules</h5>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="useDefaultNameFindRules" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="default-rules-content collapsed">
                            <textarea id="defaultNameFindRules" class="setting-textarea default-rules-textarea" rows="3" 
                                readonly placeholder="Default rules will appear here..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Custom Rules Section -->
                    <div class="custom-rules-section collapsed">
                        <div class="custom-rules-header">
                            <div class="custom-rules-title">
                                <h5>Custom Rules (0)</h5>
                            </div>
                        </div>
                        <div class="custom-rules-content collapsed">
                            <textarea id="customNameFindRules" class="setting-textarea" rows="2" 
                                placeholder="Add your own find rules here..."></textarea>
                        </div>
                    </div>
                </div>

                <h4>Parsing Options</h4>
                <div class="setting-description-prose">
                    <p><strong>Note:</strong> Parsing trim prefixes are applied first during file parsing. The trimmed function and file names are then used as input for all categorization and naming rules above.</p>
                </div>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Function Trim Prefixes</span>
                        <button class="setting-help-icon"
                            data-tooltip="Comma-separated list of prefixes to remove from function names. Example: 'github.com/myorg/,internal/' would trim 'github.com/myorg/mypackage.Function' to 'mypackage.Function'">?</button>
                    </div>
                    <input type="text" id="functionTrimPrefixes" class="setting-text-input"
                        placeholder="github.com/company/,internal/">
                    <div class="setting-description">Remove these prefixes from function names for cleaner display.</div>
                </div>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>File Trim Prefixes</span>
                        <button class="setting-help-icon"
                            data-tooltip="Comma-separated list of prefixes to remove from file paths. Example: '/go/src/,/usr/local/' would trim '/go/src/myproject/main.go' to 'myproject/main.go'">?</button>
                    </div>
                    <input type="text" id="fileTrimPrefixes" class="setting-text-input"
                        placeholder="github.com/cockroachdb/cockroach/">
                    <div class="setting-description">Remove these prefixes from file paths for cleaner display.</div>
                </div>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Zip File Pattern</span>
                        <button class="setting-help-icon"
                            data-tooltip="Regex pattern to match files inside zip archives that should be extracted and parsed as stack trace files. Examples: '^(.*\/)?stacks\.txt$', '^logs\/.*\.txt$', '^.*\.log$'">?</button>
                    </div>
                    <input type="text" id="zipFilePattern" class="setting-text-input"
                        placeholder="^(.*\/)?stacks\.txt$">
                    <div class="setting-description">Pattern to identify stack trace files in zip archives.</div>
                </div>

            </div>
            <div class="settings-actions">
                <button id="resetSettingsBtn" class="btn btn-danger settings-reset-btn">Reset to Defaults</button>
                <button id="saveSettingsBtn" class="btn settings-save-btn">Save Settings</button>
            </div>
        </div>

    </div>

    <!-- 
    ========== DOM STRUCTURE EXAMPLE ==========
    This shows how the templates are assembled into the full hierarchy:
    
    .category-section (category-template)
    ‚îú‚îÄ‚îÄ .header
    ‚îÇ   ‚îú‚îÄ‚îÄ .category-title
    ‚îÇ   ‚îú‚îÄ‚îÄ .category-count
    ‚îÇ   ‚îî‚îÄ‚îÄ .pin-button
    ‚îî‚îÄ‚îÄ .category-content
        ‚îî‚îÄ‚îÄ .stack-section (stack-template)
            ‚îú‚îÄ‚îÄ .header
            ‚îÇ   ‚îú‚îÄ‚îÄ .stack-title  
            ‚îÇ   ‚îú‚îÄ‚îÄ .stack-count
            ‚îÇ   ‚îî‚îÄ‚îÄ .pin-button
            ‚îî‚îÄ‚îÄ .stack-content
                ‚îú‚îÄ‚îÄ .unique-stack-content (stack-trace-template)
                ‚îî‚îÄ‚îÄ .file-section (file-section-template)
                    ‚îú‚îÄ‚îÄ .header
                    ‚îÇ   ‚îú‚îÄ‚îÄ .title (.expand-icon + .file-name)
                    ‚îÇ   ‚îî‚îÄ‚îÄ .counts
                    ‚îî‚îÄ‚îÄ .section-content
                        ‚îî‚îÄ‚îÄ .group-section (group-template)
                            ‚îú‚îÄ‚îÄ .header
                            ‚îÇ   ‚îú‚îÄ‚îÄ .title (.expand-icon + .group-header-label)
                            ‚îÇ   ‚îú‚îÄ‚îÄ .group-header-count
                            ‚îÇ   ‚îî‚îÄ‚îÄ .pin-button
                            ‚îî‚îÄ‚îÄ .section-content
                                ‚îú‚îÄ‚îÄ .goroutine-entry (goroutine-template)
                                ‚îÇ   ‚îú‚îÄ‚îÄ .pin-button
                                ‚îÇ   ‚îî‚îÄ‚îÄ .goroutine-header
                                ‚îÇ       ‚îú‚îÄ‚îÄ .goroutine-header-first-line
                                ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ .goroutine-header-left
                                ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ .goroutine-created-by
                                ‚îÇ       ‚îî‚îÄ‚îÄ .goroutine-header-second-line
                                ‚îî‚îÄ‚îÄ .show-more-link (show-more-template)
    ============================================
    -->

    <!-- Main Content Templates -->
    <template id="category-template">
        <div class="section expandable category-section">
            <div class="header">
                <div class="category-title"></div>
                <div class="header-right">
                    <div class="category-count counts"></div>
                    <div class="category-stats"></div>
                </div>
                <button class="pin-button size-large">üìå</button>
            </div>
            <div class="section-content category-content"></div>
        </div>
    </template>

    <template id="stack-template">
        <div class="section expandable stack-section">
            <div class="header">
                <div class="stack-title"></div>
                <div class="header-right">
                    <div class="stack-count counts"></div>
                    <div class="stack-stats"></div>
                </div>
                <button class="pin-button size-large">üìå</button>
                <button class="copy-button size-large">üìã</button>
            </div>
            <div class="section-content stack-content"></div>
        </div>
    </template>

    <template id="file-section-template">
        <div class="section expandable file-section">
            <div class="header">
                <span class="title">
                    <span class="expand-icon"></span>
                    <span class="file-name"></span>
                </span>
                <span class="counts"></span>
            </div>
            <div class="section-content"></div>
        </div>
    </template>

    <template id="group-template">
        <div class="section expandable group-section">
            <div class="header">
                <span class="title">
                    <span class="expand-icon"></span>
                    <span class="group-header-label"></span>
                </span>
                <span class="group-header-count counts"></span>
                <button class="pin-button size-large">üìå</button>
            </div>
            <div class="section-content"></div>
        </div>
    </template>

    <template id="goroutine-template">
        <div class="goroutine-entry">
            <button class="pin-button size-small">üìå</button>
            <div class="goroutine-header">
                <div class="goroutine-header-first-line">
                    <span class="goroutine-header-left"></span>
                    <span class="goroutine-created-by"></span>
                </div>
                <div class="goroutine-header-second-line"></div>
            </div>
        </div>
    </template>

    <template id="stack-trace-template">
        <div class="unique-stack-content"></div>
    </template>

    <template id="show-more-template">
        <div class="show-more-link">
            <span class="show-more-text">Show <span class="show-more-link-clickable"></span> more goroutines ‚ñº</span>
        </div>
    </template>

    <!-- File List Templates -->
    <template id="file-item-template">
        <div class="file-item">
            <span class="file-name-text" contenteditable="false"></span>
            <div class="file-stats counts"></div>
            <button class="file-remove-btn">√ó</button>
        </div>
    </template>

    <template id="file-empty-state-template">
        <div class="empty-state">Drop files here or click <strong>+</strong> to add</div>
    </template>

    <template id="file-drop-area-template">
        <div class="file-drop-area">Drop more files here</div>
    </template>

    <!-- Rule Editor Templates -->
    <template id="skip-rule-template">
        <div class="rule-item skip-rule">
            <div class="rule-controls">
                <div class="rule-input-container">
                    <span class="rule-type-prefix">skip:</span>
                    <input type="text" class="rule-input" placeholder="pattern to skip">
                </div>
                <button type="button" class="remove-rule-btn">√ó</button>
            </div>
        </div>
    </template>

    <template id="trim-rule-template">
        <div class="rule-item trim-rule">
            <div class="rule-controls">
                <div class="rule-input-container">
                    <span class="rule-type-prefix">trim:</span>
                    <input type="text" class="rule-input" placeholder="prefix to trim">
                </div>
                <button type="button" class="remove-rule-btn">√ó</button>
            </div>
        </div>
    </template>

    <template id="fold-rule-template">
        <div class="rule-item fold-rule">
            <div class="fold-rule-content">
                <div class="rule-controls">
                    <div class="rule-input-container">
                        <span class="rule-type-prefix">fold:</span>
                        <input type="text" class="rule-input rule-pattern-input" placeholder="pattern to fold" title="Enter the pattern to match and fold">
                    </div>
                </div>
                <div class="rule-replacement-line">
                    <div class="rule-input-container">
                        <span class="rule-type-prefix">‚Üí</span>
                        <input type="text" class="rule-input rule-replacement-input" placeholder="replacement text" title="Text to show instead of the folded pattern">
                    </div>
                    <div class="rule-input-container rule-while-container">
                        <span class="rule-type-prefix">while:</span>
                        <input type="text" class="rule-input rule-while-input" placeholder="" title="Optionally continue skipping additional frames matching this pattern">
                    </div>
                </div>
            </div>
            <button type="button" class="remove-rule-btn">√ó</button>
        </div>
    </template>

    <template id="find-rule-template">
        <div class="rule-item find-rule">
            <div class="fold-rule-content">
                <div class="rule-controls">
                    <div class="rule-input-container">
                        <span class="rule-type-prefix">find:</span>
                        <input type="text" class="rule-input rule-pattern-input" placeholder="pattern to find" title="Enter the pattern to find in remaining frames">
                    </div>
                </div>
                <div class="rule-replacement-line">
                    <div class="rule-input-container">
                        <span class="rule-type-prefix">‚Üí</span>
                        <input type="text" class="rule-input rule-replacement-input" placeholder="replacement text" title="Text to prepend when this pattern is found">
                    </div>
                    <div class="rule-input-container rule-while-container">
                        <span class="rule-type-prefix">while:</span>
                        <input type="text" class="rule-input rule-while-input" placeholder="" title="Optionally skip additional frames matching this pattern after finding">
                    </div>
                </div>
            </div>
            <button type="button" class="remove-rule-btn">√ó</button>
        </div>
    </template>

    <!-- Category Rule Templates -->
    <template id="category-skip-rule-template">
        <div class="rule-item skip-rule">
            <div class="rule-controls">
                <div class="rule-input-container">
                    <span class="rule-type-prefix">skip:</span>
                    <input type="text" class="rule-input" placeholder="pattern to skip when categorizing">
                </div>
                <button type="button" class="remove-rule-btn">√ó</button>
            </div>
        </div>
    </template>

    <template id="category-match-rule-template">
        <div class="rule-item match-rule">
            <div class="rule-controls">
                <div class="rule-input-container">
                    <span class="rule-type-prefix">match:</span>
                    <input type="text" class="rule-input" placeholder="pattern#group -- comment (e.g., pattern#1 -- extract first part)">
                </div>
                <button type="button" class="remove-rule-btn">√ó</button>
            </div>
        </div>
    </template>


    <template id="category-unknown-rule-template">
        <div class="rule-item unknown-rule">
            <div class="rule-controls">
                <div class="rule-input-container">
                    <span class="rule-type-prefix">unknown:</span>
                    <textarea class="rule-json-input" placeholder="JSON representation of rule" rows="2"></textarea>
                </div>
                <button type="button" class="remove-rule-btn">√ó</button>
            </div>
        </div>
    </template>

    <script type="module">
        import { StackTraceApp } from './index.js';
        // Initialize the application with custom defaults.
        const app = new StackTraceApp(window.stackGazerDefaults);
        window.app = app;
        console.log('Go Stack Trace Viewer loaded');
    </script>
</body>

</html>
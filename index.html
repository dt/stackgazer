<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StackGazer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîç</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 300px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            padding: 20px;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .view-controls-bar {
            background: #252526;
            border-bottom: 1px solid #3e3e42;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            min-height: 50px;
        }
        
        .parsing-progress {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #007acc;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }
        
        .parsing-progress.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .parsing-progress.error {
            background: #f44747;
        }
        
        .parsing-progress.complete {
            background: #4caf50;
        }
        
        .file-processing-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.3s ease;
        }
        
        .file-processing-modal.hidden {
            display: none;
        }
        
        .file-processing-content {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 40px;
            max-width: 500px;
            min-width: 400px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        
        .file-processing-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #d4d4d4;
        }
        
        .file-processing-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #3e3e42;
            border-top: 3px solid #007acc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .file-processing-details {
            color: #888;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .file-processing-file {
            margin: 8px 0;
            padding: 8px 12px;
            background: #1e1e1e;
            border-radius: 4px;
            border-left: 3px solid #007acc;
        }
        
        .file-processing-file.completed {
            border-left-color: #4caf50;
            opacity: 0.7;
        }
        
        .file-processing-file.error {
            border-left-color: #f44747;
        }
        
        .file-processing-file-name {
            font-weight: bold;
            color: #d4d4d4;
        }
        
        .file-processing-file-status {
            font-size: 12px;
            margin-top: 4px;
        }

        .view-controls-bar .view-controls {
            display: flex;
            flex-direction: row;
            gap: 10px;
            flex-wrap: wrap;
        }

        .view-controls-bar .left-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .view-controls-bar .right-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .view-controls-bar select {
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            font-family: inherit;
            font-size: 11px;
            padding: 4px 8px;
        }

        .view-controls-bar select:focus {
            outline: none;
            border-color: #007acc;
        }

        .view-controls-bar .control-btn {
            padding: 6px 12px;
            font-size: 11px;
            min-width: 80px;
        }

        .view-controls-bar label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #d4d4d4;
            font-size: 11px;
            white-space: nowrap;
        }

        .drop-zone {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #007acc;
            margin: 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drop-zone.dragover {
            border-color: #00d7ff;
            background: rgba(0, 122, 204, 0.1);
        }

        .drop-zone.has-content {
            align-items: flex-start;
            justify-content: flex-start;
            padding: 0;
            border: none;
            margin: 0;
            border-radius: 0;
            overflow-y: auto;
        }

        .drop-message {
            text-align: center;
            color: #007acc;
            font-size: 18px;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-section h3 {
            color: #007acc;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .filter-input {
            width: 100%;
            padding: 8px;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            font-family: inherit;
            margin-bottom: 10px;
        }

        .filter-input:focus {
            outline: none;
            border-color: #007acc;
        }

        .filter-input.error {
            border-color: #d73a49;
            background: rgba(215, 58, 73, 0.1);
        }

        .stack-display {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
            white-space: pre-wrap;
            font-size: 12px;
            line-height: 1.4;
            box-sizing: border-box;
        }

        .stack-group {
            margin-bottom: 20px;
            border: 2px solid #007acc;
            border-radius: 8px;
            overflow: hidden;
        }

        .group-header {
            background: #007acc;
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .group-header:hover {
            background: #0087d4;
        }

        .group-title {
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .group-title-text {
            font-weight: bold;
            color: white;
        }

        .group-title-summary {
            font-weight: normal;
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            padding-left: 12px;
            border-left: 1px solid rgba(255, 255, 255, 0.3);
        }

        .group-controls {
            display: flex;
            gap: 5px;
        }

        .group-control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-family: inherit;
            font-size: 10px;
        }

        .group-control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Pin button styles */
        .pin-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 4px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s ease;
            opacity: 0.9;
        }

        .pin-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
            opacity: 1;
        }

        .pin-btn.pinned {
            color: #ffd700;
            opacity: 1;
        }

        .pin-btn.pinned:hover {
            color: #ffed4e;
        }

        /* Goroutine pin button styles */
        .goroutine-pin-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.3);
            padding: 2px 4px;
            border-radius: 2px;
            cursor: pointer;
            font-family: inherit;
            font-size: 10px;
            transition: all 0.2s ease;
            opacity: 0.5;
        }

        .goroutine-pin-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            opacity: 1;
        }

        .goroutine-pin-btn.pinned {
            color: #ffd700;
            opacity: 1;
        }

        .goroutine-pin-btn.pinned:hover {
            color: #ffed4e;
        }

        .group-content {
            background: #2d2d30;
        }

        .group-content.collapsed {
            display: none;
        }

        .unique-stack-view {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            margin: 10px;
        }

        .unique-stack-header {
            background: #4e4e52;
            color: #fff;
            padding: 8px 15px;
            font-size: 12px;
            font-weight: bold;
            border-bottom: 1px solid #3e3e42;
            border-radius: 6px 6px 0 0;
        }

        .unique-stack-content {
            padding: 15px;
        }

        .state-group {
            background: #3c3c3c;
            margin: 10px;
            border-radius: 4px;
            overflow: hidden;
        }

        .state-group-header {
            background: #4e4e52;
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 11px;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .state-group-header:hover {
            background: #5e5e62;
        }

        .state-group-content {
            display: block;
        }

        .state-group-content.collapsed {
            display: none;
        }

        .remaining-goroutines {
            display: block;
        }

        .remaining-goroutines.collapsed {
            display: none;
        }

        .show-more-link {
            padding: 8px 12px;
            margin: 4px 0;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            color: #007acc;
            font-size: 13px;
            transition: background-color 0.2s;
        }

        .show-more-link:hover {
            background: #4a4a4a;
        }

        .show-more-text {
            user-select: none;
        }

        .goroutine-entry {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            overflow: hidden;
        }

        .goroutine-entry:last-child {
            border-bottom: none;
        }

        .goroutine-entry.highlighted {
            background: #4a4a00 !important;
            border: 2px solid #ffd700 !important;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5) !important;
        }

        .goroutine-header {
            background: #3e3e42;
            color: white;
            padding: 6px 12px;
            font-size: 11px;
            cursor: pointer;
            user-select: none;
        }

        .goroutine-header-first-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .goroutine-header-left {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .goroutine-header-second-line {
            margin-top: 4px;
            font-size: 10px;
            color: #bbb;
            font-style: italic;
        }

        .created-goroutines-label {
            color: #999;
        }

        .created-goroutines-more {
            color: #888;
        }

        .created-goroutines-more.clickable {
            color: #007acc;
            cursor: pointer;
            text-decoration: underline;
        }

        .created-goroutines-more.clickable:hover {
            color: #4fc3f7;
        }

        .goroutine-header:hover {
            background: #4e4e52;
        }

        .goroutine-created-by {
            font-size: 10px;
            color: #999;
            font-style: italic;
        }

        .goroutine-created-by .creator-link {
            color: #007acc;
            cursor: pointer;
            text-decoration: underline;
        }

        .goroutine-created-by .creator-link:hover {
            color: #4fc3f7;
        }

        .goroutine-created-by .creator-missing {
            color: #888;
            text-decoration: line-through;
        }

        .goroutine-stack {
            padding: 10px 15px;
            display: none;
        }

        .goroutine-stack.expanded {
            display: block;
        }

        .stack-line {
            margin-bottom: 2px;
        }

        .function-name {
            color: #4ec9b0;
            word-break: break-all;
            overflow-wrap: break-word;
        }

        .file-path {
            color: #9cdcfe;
            word-break: break-all;
            overflow-wrap: break-word;
        }

        .line-number {
            color: #b5cea8;
        }

        .function-args-short {
            color: #666;
            font-size: 10px;
            cursor: pointer;
        }

        .function-args-short:hover {
            color: #888;
        }

        .function-args-full {
            color: #d4d4d4;
            font-size: 10px;
        }
        .creator-link {
            color: #569cd6;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s ease;
        }
        .creator-link:hover {
            color: #4fc3f7;
            text-decoration: underline;
        }
        .creator-missing {
            text-decoration: line-through;
        }
        .created-by-line {
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid #3e3e42;
        }
        .created-by-text {
            color: #888;
        }



        .stats {
            background: #2d2d30;
            padding: 15px;
            border-bottom: 1px solid #3e3e42;
            font-size: 12px;
        }

        .stats-item {
            margin-bottom: 5px;
        }

        .state-item {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
            transition: background-color 0.2s;
        }

        .state-item:hover {
            background-color: #3e3e42;
        }

        .state-item.state-only {
            background-color: rgba(0, 122, 204, 0.2);
            color: #007acc;
            font-weight: bold;
        }

        .state-item.state-excluded {
            text-decoration: line-through;
            color: #d73a49;
        }

        .state-item.state-grayed {
            opacity: 0.5;
            color: #666;
        }

        .sidebar .view-controls {
            display: none;
        }

        .control-btn {
            background: #007acc;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }

        .control-btn:hover {
            background: #0087d4;
        }

        .control-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .control-btn:disabled:hover {
            background: #555;
        }

        .clear-btn {
            background: #d73a49;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            width: 100%;
            margin-top: 10px;
        }

        .clear-btn:hover {
            background: #e03e53;
        }

        .file-section {
            margin-bottom: 20px;
        }

        .file-list-container {
            border: 1px solid #555;
            border-radius: 6px;
            background: #2d2d30;
            transition: all 0.3s ease;
            min-height: 40px;
        }

        .file-list-container.dragover {
            border-color: #007acc;
            background: rgba(0, 122, 204, 0.1);
        }

        .file-list {
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #3c3c3c;
            padding: 8px 10px;
            margin: 5px 5px 0 5px;
            border-radius: 4px;
            font-size: 12px;
        }

        .file-item:last-child {
            margin-bottom: 5px;
        }

        .file-item.file-hidden {
            opacity: 0.5;
            background: #2a2a2a;
        }

        .file-item.file-hidden .file-name {
            color: #888;
            text-decoration: line-through;
        }

        .file-item:hover {
            background: #444;
        }

        .file-item.file-hidden:hover {
            background: #333;
        }

        .file-name {
            flex: 1;
            margin-right: 8px;
            overflow-x: auto;
            white-space: nowrap;
        }

        .file-controls {
            display: flex;
            gap: 5px;
        }

        .file-remove-btn {
            background: #d73a49;
            border: none;
            color: white;
            border-radius: 2px;
            padding: 2px 6px;
            cursor: pointer;
            font-size: 10px;
        }

        .file-stats {
            font-size: 10px;
            color: #888;
            margin-top: 2px;
        }

        .file-drop-area {
            padding: 8px;
            text-align: center;
            color: #666;
            font-size: 10px;
            opacity: 0.7;
            cursor: pointer;
            border-top: 1px dashed #555;
            margin-top: 5px;
            display: none;
        }

        .file-list-container:hover .file-drop-area,
        .file-list-container.dragover .file-drop-area {
            opacity: 1;
        }

        .file-list-container.has-files .file-drop-area {
            display: block;
        }

        .empty-state {
            padding: 15px;
            text-align: center;
            color: #888;
            font-size: 11px;
        }

        /* Add File Button */
        .add-file-btn {
            background: transparent;
            border: 1px solid #555;
            color: #666;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            font-size: 8px;
            font-weight: normal;
            cursor: pointer;
            margin-left: 2px;
            vertical-align: middle;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            opacity: 0.6;
        }

        .add-file-btn:hover {
            background: #3e3e42;
            color: #d4d4d4;
            border-color: #666;
            opacity: 1;
        }

        .clear-all-btn {
            background: transparent;
            border: 1px solid #d73a49;
            color: #d73a49;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 8px;
            margin-bottom: 10px;
            vertical-align: middle;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            opacity: 0.7;
        }

        .clear-all-btn:hover {
            background: #d73a49;
            color: white;
            opacity: 1;
        }

        .files-header, .filter-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .files-title {
            display: flex;
            align-items: center;
        }


        /* Filter Help Button - small and subtle */
        .filter-help-btn {
            background: transparent;
            border: 1px solid #555;
            color: #666;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            font-size: 8px;
            font-weight: normal;
            cursor: pointer;
            margin-left: 2px;
            vertical-align: middle;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            opacity: 0.6;
        }

        .filter-help-btn:hover {
            background: #3e3e42;
            color: #d4d4d4;
            border-color: #666;
            opacity: 1;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background-color: #2d2d30;
            margin: 5% auto;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            padding: 20px 25px 15px;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #252526;
            border-radius: 8px 8px 0 0;
        }

        .modal-header h3 {
            color: #007acc;
            margin: 0;
            font-size: 18px;
        }

        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .modal-close:hover {
            background: #3e3e42;
            color: #d4d4d4;
        }

        .modal-body {
            padding: 25px;
            color: #d4d4d4;
            line-height: 1.6;
        }

        .modal-body h4 {
            color: #007acc;
            margin: 20px 0 10px 0;
            font-size: 14px;
            border-bottom: 1px solid #3e3e42;
            padding-bottom: 5px;
        }

        .modal-body h4:first-child {
            margin-top: 0;
        }

        .modal-body ul {
            margin: 10px 0 20px 20px;
            padding: 0;
        }

        .modal-body li {
            margin-bottom: 8px;
            list-style-type: disc;
        }

        .modal-body code {
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 3px;
            padding: 2px 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 11px;
            color: #4ec9b0;
        }

        .modal-body p {
            margin: 10px 0;
        }

        .modal-body strong {
            color: #ffd700;
        }

        /* Side-by-side stack display styles */
        .side-by-side-container {
            width: 100%;
        }

        .side-by-side-headers {
            display: flex;
            gap: 20px;
            margin-bottom: 5px;
        }

        .side-by-side-headers .column-header {
            flex: 1;
            background: #4e4e52;
            color: white;
            padding: 6px 10px;
            font-weight: bold;
            font-size: 11px;
            border-radius: 4px 4px 0 0;
        }

        .side-by-side-row {
            display: flex;
            gap: 20px;
            margin-bottom: 1px;
            align-items: flex-start;
        }

        .function-side, .location-side {
            flex: 1;
            padding: 2px 10px;
            border-left: 2px solid #007acc;
            min-height: 20px;
            display: flex;
            align-items: flex-start;
            flex-wrap: wrap;
            word-break: break-all;
            overflow-wrap: break-word;
            min-width: 0;
        }

        .function-side {
            background: rgba(78, 201, 176, 0.1);
        }

        .location-side {
            background: rgba(156, 220, 254, 0.1);
        }

        .creator-function {
            color: #4ec9b0;
            font-weight: bold;
        }

        /* Stack display mode CSS-based switching - merge with existing .unique-stack-content */

        /* Hide all display modes by default - use absolute positioning to avoid layout space */
        .stack-display-combined,
        .stack-display-side-by-side,
        .stack-display-functions,
        .stack-display-locations {
            display: none;
            margin: 0;
            padding: 0;
        }

        /* Show the appropriate display mode based on data attribute */
        .unique-stack-content[data-display-mode="combined"] .stack-display-combined {
            display: block;
        }

        .unique-stack-content[data-display-mode="side-by-side"] .stack-display-side-by-side {
            display: block;
        }

        .unique-stack-content[data-display-mode="functions"] .stack-display-functions {
            display: block;
        }

        .unique-stack-content[data-display-mode="locations"] .stack-display-locations {
            display: block;
        }

        /* Settings gear icon */
        .settings-container {
            position: absolute;
            bottom: 15px;
            left: 15px;
            display: flex;
            gap: 10px;
        }

        .settings-btn {
            background: transparent;
            border: 1px solid #555;
            color: #666;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.6;
            transition: all 0.2s ease;
        }

        .settings-btn:hover {
            background: #3e3e42;
            color: #d4d4d4;
            border-color: #666;
            opacity: 1;
            transform: rotate(90deg);
        }

        /* GitHub link */
        .github-btn {
            background: transparent;
            border: 1px solid #555;
            color: #666;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.6;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .github-btn:hover {
            background: #3e3e42;
            color: #d4d4d4;
            border-color: #666;
            opacity: 1;
        }

        /* Settings modal specific styles */
        .setting-group {
            margin-bottom: 20px;
            padding: 15px;
            background: #3c3c3c;
            border-radius: 6px;
            border: 1px solid #555;
        }

        .setting-title {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            font-weight: bold;
            color: #d4d4d4;
            font-size: 14px;
        }

        .setting-help-icon {
            background: transparent;
            border: 1px solid #666;
            color: #999;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            font-weight: bold;
            cursor: help;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            opacity: 0.8;
            transition: all 0.2s ease;
        }

        .setting-help-icon:hover {
            background: #4a4a4a;
            color: #d4d4d4;
            border-color: #888;
            opacity: 1;
        }

        /* Tooltip styles */
        .setting-help-icon[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            top: -8px;
            transform: translateX(-50%) translateY(-100%);
            background: #1a1a1a;
            color: #d4d4d4;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: normal;
            line-height: 1.4;
            white-space: normal;
            width: 280px;
            text-align: left;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border: 1px solid #555;
            z-index: 1001;
            pointer-events: none;
        }

        .setting-help-icon[data-tooltip]:hover::before {
            content: '';
            position: absolute;
            left: 50%;
            top: -4px;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: #555;
            z-index: 1001;
            pointer-events: none;
        }

        .setting-label {
            display: block;
            cursor: pointer;
            color: #d4d4d4;
            font-size: 13px;
        }

        .setting-checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: #d4d4d4;
            font-size: 13px;
        }

        .setting-checkbox-text {
            color: #d4d4d4;
        }

        .setting-text {
            font-weight: bold;
            margin-left: 8px;
        }

        .setting-description {
            font-size: 11px;
            color: #999;
            margin-top: 8px;
            line-height: 1.4;
        }

        .setting-checkbox {
            width: 16px;
            height: 16px;
            margin: 0;
            vertical-align: middle;
        }

        .setting-input {
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            padding: 6px 10px;
            font-family: inherit;
            font-size: 12px;
            width: 80px;
            margin-top: 4px;
        }

        .setting-input:focus {
            outline: none;
            border-color: #007acc;
        }

        .setting-text-input {
            background: #2d2d30;
            border: 1px solid #555;
            border-radius: 4px;
            color: #d4d4d4;
            padding: 6px 10px;
            font-family: inherit;
            font-size: 12px;
            width: 100%;
            margin-top: 4px;
        }

        .setting-text-input:focus {
            outline: none;
            border-color: #007acc;
        }

        .setting-text-input::placeholder {
            color: #666;
            font-style: italic;
        }

        .settings-warning {
            margin-top: 20px;
            padding: 12px 15px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 4px;
            color: #ffc107;
            font-size: 12px;
            line-height: 1.4;
        }

        .settings-warning strong {
            color: #ffc107;
        }

        .settings-actions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #3e3e42;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .settings-reset-btn {
            background: #d73a49;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }

        .settings-reset-btn:hover {
            background: #e03e53;
        }

        .settings-save-btn {
            background: #007acc;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }

        .settings-save-btn:hover {
            background: #0087d4;
        }

        /* Demo link styles */
        .demo-link {
            color: #569cd6;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s ease, text-decoration 0.2s ease;
        }

        .demo-link:hover {
            color: #4fc3f7;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="filter-section file-section">
                <div class="files-header">
                    <div class="files-title">
                        <h3>Files <button class="add-file-btn" id="addFileBtn" title="Add more files">+</button></h3>
                    </div>
                    <button class="clear-all-btn" id="clearAllBtn" title="Clear all files">√ó</button>
                </div>
                <div class="file-list-container" id="fileListContainer">
                    <div class="file-list" id="fileList"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-header">
                    <h3>Filter <button class="filter-help-btn" id="filterHelpBtn" title="Show filter syntax help">?</button></h3>
                    <button class="clear-all-btn" id="clearFilterBtn" title="Clear filter">√ó</button>
                </div>
                <input type="text" class="filter-input" id="filterInput" placeholder="Enter filter (e.g., state:run, dur:>5, function_name)">
            </div>

            <div class="filter-section">
                <h3>Statistics</h3>
                <div class="stats" id="stats">
                    <div class="stats-item">Total goroutines: <span id="totalGoroutines">0</span></div>
                    <div class="stats-item">Visible goroutines: <span id="visibleGoroutines">0</span></div>
                    <div class="stats-item">Hidden goroutines: <span id="hiddenGoroutines">0</span></div>
                    <div class="stats-item">Unique stacks: <span id="uniqueStacks">0</span></div>
                    <div class="stats-item">Visible unique stacks: <span id="visibleUniqueStacks">0</span></div>
                    <div class="stats-item">Pinned stacks: <span id="pinnedStacks">0</span></div>
                    <div class="stats-item">Pinned goroutines: <span id="pinnedGoroutines">0</span></div>
                    <div id="stateBreakdown" class="stats-item" style="margin-top: 10px; font-size: 11px;">
                        <div style="font-weight: bold; margin-bottom: 5px;">Goroutines by state:</div>
                        <div id="stateList"></div>
                    </div>
                </div>
            </div>

            <!-- Settings gear icon in bottom left -->
            <div class="settings-container">
                <a href="https://github.com/dt/stackgazer" target="_blank" class="github-btn" title="View on GitHub">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                </a>
                <button class="settings-btn" id="settingsBtn" title="Advanced Settings">‚öôÔ∏è</button>
            </div>

        </div>

        <div class="main-content">
            <div class="view-controls-bar">
                <div class="left-controls">
                    <button id="backBtn" class="control-btn" disabled title="Go back to previous goroutine (Alt+‚Üê or Backspace)">‚Üê Back</button>
                </div>
                <div class="right-controls">
                    <select id="stackDisplayModeSelect" title="Choose how to display stack traces">
                        <option value="combined">Combined View</option>
                        <option value="side-by-side">Side by Side</option>
                        <option value="functions">Functions Only</option>
                        <option value="locations">Locations Only</option>
                    </select>
                    <button id="unpinAllBtn" class="control-btn">Unpin All</button>
                    <button id="expandAllBtn" class="control-btn">Expand All</button>
                    <button id="collapseAllBtn" class="control-btn">Collapse All</button>
                </div>
            </div>
            <div class="drop-zone" id="dropZone">
                <!-- Initial content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script type="module">
        import { StackTraceApp } from './dist/ui/StackTraceApp.js';
        
        // Initialize the application
        const app = new StackTraceApp();
        
        // For debugging
        window.app = app;
    </script>

    <!-- Filter Help Modal -->
    <div id="filterHelpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Filter Syntax Help</h3>
                <button class="modal-close" id="modalCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Syntax</h4>
                <ul>
                    <li><code>state:run</code> <code>state:select</code> - Match by goroutine state</li>
                    <li><code>dur:>5</code> <code>dur:>=10</code> <code>dur:<2</code> <code>dur:<=1</code> - Duration filters (minutes)</li>
                    <li><code>-state:select</code> <code>-dur:>5</code> - Exclude with minus prefix</li>
                    <li><code>function1</code> <code>main</code> <code>123</code> - Text search in IDs and stack traces</li>
                </ul>

                <h4>Examples</h4>
                <ul>
                    <li><code>state:running</code> <code>dur:>10</code> <code>-GOROOT</code> - Single filters</li>
                    <li><code>state:running function1</code> <code>dur:>5 -state:select</code> - Combined filters (AND logic)</li>
                    <li><code>main.worker</code> <code>state:select dur:<5</code> - Text + field combinations</li>
                </ul>

                <h4>Notes</h4>
                <ul>
                    <li>Case-insensitive ‚Ä¢ Pinned items always visible ‚Ä¢ Multiple terms = AND logic</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Advanced Settings</h3>
                <button class="modal-close" id="settingsModalCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Parsing Options</h4>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Function Trim Prefixes</span>
                        <button class="setting-help-icon" data-tooltip="Comma-separated list of prefixes to remove from function names. Example: 'github.com/myorg/,internal/' would trim 'github.com/myorg/mypackage.Function' to 'mypackage.Function'">?</button>
                    </div>
                    <input type="text" id="functionTrimPrefixes" class="setting-text-input" placeholder="github.com/company/,internal/">
                    <div class="setting-description">Remove these prefixes from function names for cleaner display</div>
                </div>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>File Trim Prefixes</span>
                        <button class="setting-help-icon" data-tooltip="Comma-separated list of prefixes to remove from file paths. Example: '/go/src/,/usr/local/' would trim '/go/src/myproject/main.go' to 'myproject/main.go'">?</button>
                    </div>
                    <input type="text" id="fileTrimPrefixes" class="setting-text-input" placeholder="github.com/cockroachdb/cockroach/">
                    <div class="setting-description">Remove these prefixes from file paths for cleaner display</div>
                </div>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Title Manipulation Rules</span>
                        <button class="setting-help-icon" data-tooltip="Control how stack titles are generated (one rule per line):&#10;‚Ä¢ skip:pattern - Skip matching functions&#10;‚Ä¢ fold:pattern->prefix - Skip and add prefix&#10;‚Ä¢ foldstdlib:pattern->replacement - Skip, add replacement, skip stdlib&#10;‚Ä¢ trim:prefix - Remove prefix from function names">?</button>
                    </div>
                    <textarea id="titleManipulationRules" class="setting-text-input" placeholder="skip:sync.runtime_Semacquire&#10;fold:sync.(*WaitGroup).Wait->Group&#10;trim:github.com/cockroachdb/cockroach/" rows="5" style="resize: vertical; min-height: 100px;"></textarea>
                    <div class="setting-description">Rules to customize how stack trace titles are generated (one per line)</div>
                </div>

                <h4>Display Options</h4>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Initial Goroutines per State</span>
                        <button class="setting-help-icon" data-tooltip="Controls how many goroutines are shown initially in each state group before the 'show more' link appears. Higher values show more goroutines immediately but may slow down rendering for large datasets.">?</button>
                    </div>
                    <input type="number" id="maxInitialGoroutines" class="setting-input" min="1" max="50" value="5">
                    <div class="setting-description">Number of goroutines shown before "show more" link</div>
                </div>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Auto-expand Unique Stacks</span>
                        <button class="setting-help-icon" data-tooltip="When enabled, all unique stack groups will be expanded by default when loading files. When disabled, you'll need to manually click on each group header to expand them.">?</button>
                    </div>
                    <label class="setting-checkbox-label">
                        <input type="checkbox" id="autoExpandStacks" class="setting-checkbox">
                        <span class="setting-checkbox-text">Automatically expand all unique stack groups on load</span>
                    </label>
                </div>

                <h4>File Handling</h4>
                <div class="setting-group">
                    <div class="setting-title">
                        <span>Zip File Pattern</span>
                        <button class="setting-help-icon" data-tooltip="Glob pattern to match files inside zip archives that should be extracted and parsed as stack trace files. Use ** for recursive directory matching. Examples: '**/stacks.txt', 'logs/*.txt', '*.log'">?</button>
                    </div>
                    <input type="text" id="zipFilePattern" class="setting-text-input" placeholder="**/stacks.txt">
                    <div class="setting-description">Pattern to match stack trace files in zip archives</div>
                </div>

                <div class="settings-warning">
                    <strong>‚ö†Ô∏è Note:</strong> altering settings will reload the app; files will need to be reimported.
                </div>

                <div class="settings-actions">
                    <button id="resetSettingsBtn" class="settings-reset-btn">Reset to Defaults</button>
                    <button id="saveSettingsBtn" class="settings-save-btn">Save Settings</button>
                </div>
            </div>
        </div>
        
        <!-- Parsing progress indicator -->
        <div id="parsingProgress" class="parsing-progress hidden"></div>
        
        <!-- File processing modal -->
        <div id="fileProcessingModal" class="file-processing-modal hidden">
            <div class="file-processing-content">
                <div class="file-processing-title">Processing Files</div>
                <div class="file-processing-spinner"></div>
                <div class="file-processing-details">
                    <div id="fileProcessingMessage">Parsing and loading files...</div>
                    <div id="fileProcessingFiles"></div>
                </div>
            </div>
        </div>
        
        <!-- Rendering modal -->
        <div id="renderingModal" class="file-processing-modal hidden">
            <div class="file-processing-content">
                <div class="file-processing-title">Rendering Stack Traces</div>
                <div class="file-processing-spinner"></div>
                <div class="file-processing-details">
                    <div id="renderingMessage">Building UI components...</div>
                    <div id="renderingProgress"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { StackTraceApp } from './dist/ui/StackTraceApp.js';
        
        // Initialize the application
        const app = new StackTraceApp();
        
        // For debugging
        window.app = app;
        
        console.log('Go Stack Trace Viewer loaded');
    </script>
</body>
</html>